{#
/**
 * @file
 * Debug entity reference access
 */
#}

<div{{ attributes.addClass('subsite-agenda') }}>

  <h2>Entity Reference Debug</h2>

  {% if content.field_subsite_daily_schedule['#items'] is not empty %}
    {% set daily_schedules = content.field_subsite_daily_schedule['#items'] %}
    
    <p><strong>Daily schedules count:</strong> {{ daily_schedules|length }}</p>
    
    {% for key, day_item in daily_schedules %}
      <div style="border: 2px solid #333; padding: 15px; margin: 15px 0; background: #f5f5f5;">
        <h3>Day Item {{ key + 1 }}</h3>
        
        <h4>Full day_item dump:</h4>
        <pre style="background: white; padding: 10px; overflow: auto; max-height: 300px;">{{ dump(day_item) }}</pre>
        
        <hr>
        
        <h4>Checking day_item.entity:</h4>
        <p><strong>day_item.entity exists:</strong> {{ day_item.entity is defined ? 'YES' : 'NO' }}</p>
        
        {% if day_item.entity is defined %}
          <p><strong>day_item.entity is null:</strong> {{ day_item.entity is null ? 'YES' : 'NO' }}</p>
          
          {% if day_item.entity is not null %}
            <p><strong>Entity type:</strong> {{ day_item.entity.getEntityTypeId() }}</p>
            <p><strong>Entity bundle:</strong> {{ day_item.entity.bundle() }}</p>
            <p><strong>Entity ID:</strong> {{ day_item.entity.id() }}</p>
            
            <h5>Available fields on entity:</h5>
            <ul>
              {% for field_name in day_item.entity.getFields()|keys %}
                <li>{{ field_name }}</li>
              {% endfor %}
            </ul>
            
            <hr>
            
            <h5>Testing field_microsite_event_date:</h5>
            <p><strong>Field exists:</strong> {{ day_item.entity.hasField('field_microsite_event_date') ? 'YES' : 'NO' }}</p>
            {% if day_item.entity.hasField('field_microsite_event_date') %}
              <p><strong>Field value:</strong> {{ day_item.entity.field_microsite_event_date.value }}</p>
            {% endif %}
            
            <hr>
            
            <h5>Testing field_event_daily_schedule:</h5>
            <p><strong>Field exists:</strong> {{ day_item.entity.hasField('field_event_daily_schedule') ? 'YES' : 'NO' }}</p>
            {% if day_item.entity.hasField('field_event_daily_schedule') %}
              <p><strong>Field is empty:</strong> {{ day_item.entity.field_event_daily_schedule.isEmpty() ? 'YES' : 'NO' }}</p>
              <p><strong>Schedule items count:</strong> {{ day_item.entity.field_event_daily_schedule|length }}</p>
              
              {% set schedule_items = day_item.entity.field_event_daily_schedule %}
              
              {% if schedule_items is not empty %}
                <h6>Schedule Items:</h6>
                {% for sched_key, sched_item in schedule_items %}
                  <div style="background: white; padding: 10px; margin: 10px 0;">
                    <p><strong>Schedule {{ sched_key + 1 }}:</strong></p>
                    <p>sched_item.entity exists: {{ sched_item.entity is defined ? 'YES' : 'NO' }}</p>
                    {% if sched_item.entity is defined and sched_item.entity is not null %}
                      <p>Title field exists: {{ sched_item.entity.hasField('field_microsite_section_title') ? 'YES' : 'NO' }}</p>
                      {% if sched_item.entity.hasField('field_microsite_section_title') %}
                        <p>Title: {{ sched_item.entity.field_microsite_section_title.value }}</p>
                      {% endif %}
                    {% else %}
                      <p style="color: red;">Schedule item entity is null or undefined!</p>
                      <pre>{{ dump(sched_item) }}</pre>
                    {% endif %}
                  </div>
                {% endfor %}
              {% endif %}
            {% endif %}
            
          {% else %}
            <p style="color: red; font-weight: bold;">ERROR: day_item.entity is NULL</p>
            <p>This means the referenced entity doesn't exist or isn't loaded.</p>
          {% endif %}
          
        {% else %}
          <p style="color: red; font-weight: bold;">ERROR: day_item.entity is not defined</p>
        {% endif %}
        
        <hr>
        
        <h4>Alternative access methods:</h4>
        <p><strong>day_item['entity']:</strong> {{ day_item['entity'] is defined ? 'EXISTS' : 'NOT DEFINED' }}</p>
        <p><strong>day_item.getValue():</strong></p>
        <pre style="background: white; padding: 10px;">{{ dump(day_item.getValue()) }}</pre>
        
      </div>
    {% endfor %}
    
  {% else %}
    <p style="color: red;">No daily schedules found</p>
  {% endif %}

</div>
